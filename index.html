<!doctype html> 
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tic Tac Toe</title>
  <script type="text/javascript" charset="utf-8">
  var grid = 3;
  var combos = [];
  var board = [];
  // var intelligence = 6;
  // var undef;

  // calculate all winning combos
  for (i = 0, c = [], d = []; i < grid; i++){
    for (j = 0, a = [], b = []; j < grid; j++){
      a.push(i * grid + j);
      b.push(j * grid + i);
    }
    combos.push(a, b);
    c.push(i * grid + i);
    d.push((grid - i - 1) * grid + i);
  }
  combos.push(c, d);

  function processInput (move) {
    if (!board[move]) {
      display(move, -1);
      if (chk(0) < 0) {          
       alert("You win!");  clearBoard(); return;       
     }
     next = negamax(0, 1, -100, 100);
     // next = search(0, 1, -100, 100);
     if (next==undefined) {
      clearBoard();
      alert("This was a tie.");  clearBoard(); return;
    }
    display(next);
    if (chk(0) > 0) {
      clearBoard();
      alert("You lose.");  clearBoard(); return;
    }
  }   
}

  // method to check if game won
  // uses depth to give higher values to quicker wins
  function chk(depth){
    for (var i=0; i<combos.length; i++) {
      j = x = o = grid;
      while(j--){
        k = combos[i][j];
        board[k] > 0 && x--;
        board[k] < 0 && o--;
      }
      if (!x) return 100 - depth; // x won
      if (!o) return depth - 100; // o won
    }
  }

  function wins(val) {
   if (board[0] == val && board[1] == val && board[2] == val) {
    return true
  }

  else  if (board[3] == val && board[4] == val && board[5] == val) {
    return true
  }

  else  if (board[6] == val && board[7] == val && board[8] == val) {
    return true
  }

  else  if (board[0] == val && board[4] == val && board[8] == val) {
    return true
  }

  else  if (board[2] == val && board[4] == val && board[6] == val) {
    return true
  }

  else  if (board[0] == val && board[3] == val && board[6] == val) {
    return true
  }

  else  if (board[1] == val && board[4] == val && board[7] == val) {
    return true
  }

  else  if (board[2] == val && board[5] == val && board[8] == val) {
    return true
  }

  else
    return false
}

function display(i, o)     {
  board[i] = o || 1;
  var row, col, p;
  if (i<3){
    row = 0;
  }
  else if (i>5) {
    row = 2;
  }
  else {
    row = 1;
  }
  col = i%3;
  if (o == -1) {
    p = "   o   ";
  }
  else {
    p = "   x   ";
  }
  if (row == 0 && col == 0)
    document.leform.b00.value = p
  else if (row == 0 && col == 1)
    document.leform.b01.value = p
  else if (row == 0 && col == 2)
    document.leform.b02.value = p
  else if (row == 1 && col == 0)
    document.leform.b10.value = p
  else if (row == 1 && col == 1)
    document.leform.b11.value = p
  else if (row == 1 && col == 2)
    document.leform.b12.value = p
  else if (row == 2 && col == 0)
    document.leform.b20.value = p
  else if (row == 2 && col == 1)
    document.leform.b21.value = p
  else if (row == 2 && col == 2) 
    document.leform.b22.value =p
}

function clearBoard() {
  for (i = 0; i< board.length; i++) {
    board[i] = undefined;
  }
  document.leform.b00.value = "        "
  document.leform.b01.value = "        "
  document.leform.b02.value = "        "
  document.leform.b10.value = "        "
  document.leform.b11.value = "        "
  document.leform.b12.value = "        "
  document.leform.b20.value = "        "
  document.leform.b21.value = "        "
  document.leform.b22.value = "        "
}

  // "The Alpha-Beta Algorithm" https://www.cs.unm.edu/~aaron/downloads/qian_search.pdf
  function negamax(depth, player, alpha, beta){

    var next;
    var bestValue;
    var min = -100;
    var max;
    var val;
    
    if (chk(depth)) {
      val = chk(depth);    
      return player * val;
    }



    if (depth < 10) {    
      for(var i=0; i<9; i++){ 


        if (board[i]==undefined){  // look for available moves
          board[i] = player; // make move
          cur = -search(depth + 1, -player, -beta, -alpha);
          
          if (cur > bestValue || bestValue == undefined) {
            bestValue = cur;
          }
          if (bestValue > alpha) alpha = bestValue;
          board[i] = undefined;
          if (alpha >= beta) return alpha; // prune branch
          if (bestValue > min){ 
            min = bestValue;
             next = i; 
           }
          
        }

      } 
    } 
    if (depth > 0) {
      return bestValue || 0; // 0 means a tie
      
    }
    else return next;
  }
  </script>
</head>

<body>
  <form name = leform> 
   <center> 
    <input type = button name = b00 value = "        " onclick = processInput(0) > 
    <input type = button name = b01 value = "        " onclick = processInput(1) > 
    <input type = button name = b02 value = "        " onclick = processInput(2) ><BR> 
    <input type = button name = b10 value = "        " onclick = processInput(3) > 
    <input type = button name = b11 value = "        " onclick = processInput(4) > 
    <input type = button name = b12 value = "        " onclick = processInput(5) ><BR> 
    <input type = button name = b20 value = "        " onclick = processInput(6) > 
    <input type = button name = b21 value = "        " onclick = processInput(7) > 
    <input type = button name = b22 value = "        " onclick = processInput(8) ><BR> 
  </center> 

</form> 
</body>
</html>