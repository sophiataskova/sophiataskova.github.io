<HTML> 
  <HEAD> 
    <h1>Tic Tac Toe</h1> 
    <script language = javascript> 

    var computer, player, comp, usr, numTurns
    board = [[0,0,0],[0,0,0],[0,0,0]]; 
    sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
    startGame()

    function startGame() {      
      player = "   x   "
      computer = "   o   "  
      comp = 2
      usr = 1
      numTurns = 0
    }    

    function refresh() {
      clearBoard()
      startGame()
      return
    }

    function processInput(row, col) {
      if (isEmpty(row,col)) {
        display(row,col, player)
        board[row][col] = 1
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        numTurns ++
        
        if (wins(1)) {
          alert("You win!")
          refresh()
          return
        }

        if (gameOver()) {
          alert('This was a draw.')

          refresh()
          return
        }

        compMove()

        if (wins(2)) {
          alert('You Lose!')
          refresh()
          return
        }

        if (gameOver()) {
          alert("This was a draw.")
          refresh()
          return
        }
      }
    }

    function markSide(i,player,p) {
      if (i==0) {
        board[0][1] = player
        document.f1.b01.value = p
      }
      if (i==1) {
        board[1][0] = player
        document.f1.b10.value = p
      }
      if (i==2) {
        board[2][1] = player
        document.f1.b21.value = p
      }
      if (i==3) {
        board[1][2] = player
        document.f1.b12.value = p
      }
      sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
    }

    function display(row,col, p)     {
      if (row == 0 && col == 0)
        document.f1.b00.value = p
      else if (row == 0 && col == 1)
        document.f1.b01.value = p
      else if (row == 0 && col == 2)
        document.f1.b02.value = p
      else if (row == 1 && col == 0)
        document.f1.b10.value = p
      else if (row == 1 && col == 1)
        document.f1.b11.value = p
      else if (row == 1 && col == 2)
        document.f1.b12.value = p
      else if (row == 2 && col == 0)
        document.f1.b20.value = p
      else if (row == 2 && col == 1)
        document.f1.b21.value = p
      else if (row == 2 && col == 2) 
        document.f1.b22.value =p
    }

    function isEmpty(row,col) {
      if ( board[row][col] != 0) {
        return false
      }      
      else {
        return true
      }        
    }

    function wins(val) {
     if (board[0][0] == val && board[0][1] == val && board[0][2] == val) {
      return true
    }

    else  if (board[1][0] == val && board[1][1] == val && board[1][2] == val) {
      return true
    }

    else  if (board[2][0] == val && board[2][1] == val && board[2][2] == val) {
      return true
    }

    else  if (board[0][0] == val && board[1][0] == val && board[2][0] == val) {
      return true
    }

    else  if (board[0][1] == val && board[1][1] == val && board[2][1] == val) {
      return true
    }

    else  if (board[0][2] == val && board[1][2] == val && board[2][2] == val) {
      return true
    }

    else  if (board[0][0] == val && board[1][1] == val && board[2][2] == val) {
      return true
    }

    else  if (board[2][0] == val && board[1][1] == val && board[0][2] == val) {
      return true
    }

    else
      return false
  }

  function gameOver()   {
    if (numTurns==9) {
      return true
    }      
    return false
  }

  // what should the computer do?
  function compMove()  { 
    numTurns ++
    // When there is only token on the board so far... 
    if (numTurns == 2) {
      // ... place a token in the corner if the center is taken...
      if (board[1][1]==usr) {
        board[0][0]=comp
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        display(0,0,computer)
        return
      }
      // ... or place a token in the center if a corner is taken
      // if ((board[0][0]==usr)||(board[2][0]==usr)||(board[2][2]==usr)||(board[0][2]==usr)) {
        else {
          board[1][1]=comp
          sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
          display(1,1,computer)
          return
        }      
      // otherwise, pick random move.
    }
    
    
    else {

      // check if computer can finish a 3-in-a-row
      if(horiz(comp)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }

      if(vert(comp)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }

      if (diag1(comp)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }
      if (diag2(comp)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }
      // check if computer can block a human's 3-in-a-row
      if(horiz(usr)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }

      if(vert(usr)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }

      if (diag1(usr)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }
      if (diag2(usr)) {
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        return
      }
      if (numTurns == 4) {
        if ((board[0][0]==usr)||(board[2][0]==usr)||(board[2][2]==usr)||(board[0][2]==usr)) {
          for (i = 0; i< sides.length; i++) {
            if ((sides[i] == 0)&(sides[(i+2)%4]==0)) {
              markSide(i, comp, computer)
              return
            }
          }
        }
      }
      if(fork()) {
        return
      }
      
    }

    randomMove()
    sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
    
  }


  // check for pairs of player p2 in a horiz row that can be completed or blocked 
  function horiz(p2) {
    var count = 0
    for (i = 0; i< board.length; i++) {
      for (j = 0; j< board[i].length; j++)  {
        if (board[i][j] == p2)
          count++
      }
      if (count > 1)  {
        for (j = 0; j< board[i].length; j++) {
          if (isEmpty(i,j))
            { board[i][j] = comp
              sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
              display(i,j,computer)
              return true
            }
          }

        }
        count = 0
      }
      return false
    }


    // check for pairs of player p2 in a vertical row that can be completed or blocked 
    function vert(p2) {
      var count = 0
      for (i = 0; i< board.length; i++) {
        for (j = 0; j< board[i].length; j++) {
          if (board[j][i] == p2)
            count++
        }
        if (count > 1)  { 
          for (j = 0; j< board[i].length; j++) {
            if (isEmpty(j,i)) { 
              board[j][i] = comp
              sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
              display(j, i, computer)
              return true
            }
          }
        }
        count = 0
      }
      return false
    }


    // check for pairs of player p2 in a diagonal row that can be completed or blocked 
    function diag1(p2) {
      var count  = 0
      for (i =0; i< board.length; i++)  {
        if (board[i][i] == p2)
          count++
      }
      if (count > 1) { 
        for (i = 0; i<board.length; i++) {
          if (isEmpty(i,i)) {              
            board[i][i] = comp
            sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
            display(i,i,computer)
            return true
          }
        }
      }
      return false
    }


    // check for pairs of player p2 in a diagonal row that can be completed or blocked 
    function diag2(p2) {
      var count = 0
      var j = 2
      for (i = 0; i<board.length; i++)  {  
        if (board[i][j] == p2)
          count++
        j--
      } 

      if (count > 1) { 
        var j = 2
        for (i = 0; i<board.length; i++) {
          if (isEmpty(i,j)) {
            board[i][j] = comp
            sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
            display(i,j,computer)
            return true
          }
          j--
        }
      }
      return false
    }

    function fork() {
      var count = 0
      for (i = 0; i< board.length; i++) {
        for (j = 0; j< board[i].length; j++)  {
          if (board[i][j] != 0)
            count++
        }
        if (count == 1)  {
          for (j = 0; j< board[i].length; j++) {
            if (isEmpty(i,j))
              { board[i][j] = comp
                sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
                display(i,j,computer)
                return true
              }
            }

          }
          count = 0
        }


        var count = 0
        for (i = 0; i< board.length; i++) {
          for (j = 0; j< board[i].length; j++) {
            if (board[j][i] != 0)
              count++
          }
          if (count == 1)  { 
            for (j = 0; j< board[i].length; j++) {
              if (isEmpty(j,i)) { 
                board[j][i] = comp
                sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
                display(j, i, computer)
                return true
              }
            }
          }
          count = 0
        }

        var count  = 0
        for (i =0; i< board.length; i++)  {
          if (board[i][i] != 0)
            count++
        }
        if (count == 1) { 
          for (i = 0; i<board.length; i++) {
            if (isEmpty(i,i)) {              
              board[i][i] = comp
              sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
              display(i,i,computer)
              return true
            }
          }
        }

        var count = 0
        var j = 2
        for (i = 0; i<board.length; i++)  {  
          if (board[i][j] != 0)
            count++
          j--
        } 

        if (count == 1) { 
          var j = 2
          for (i = 0; i<board.length; i++) {
            if (isEmpty(i,j)) {
              board[i][j] = comp
              sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
              display(i,j,computer)
              return true
            }
            j--
          }
        }


        return false

      }


      function randomMove() {  
        row = Math.floor(Math.random() * 3)
        col =  Math.floor(Math.random() * 3)
        while (isEmpty(row,col) != true) { 
          row = Math.floor(Math.random() * 3)
          col =  Math.floor(Math.random() * 3)
        }
        board[row][col] = comp
        sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        display(row,col,computer)
      }


      function clearBoard() {
        for (i = 0; i< board.length; i++) {
          for (j = 0; j< board[i].length; j++)
            board[i][j] = 0
          sides = [board[0][1],board[1][2],board[2][1],board[1][0]]
        }

        document.f1.b00.value = "        "
        document.f1.b01.value = "        "
        document.f1.b02.value = "        "
        document.f1.b10.value = "        "
        document.f1.b11.value = "        "
        document.f1.b12.value = "        "
        document.f1.b20.value = "        "
        document.f1.b21.value = "        "
        document.f1.b22.value = "        "
      }


      </script> 
    </HEAD> 
    <BODY> 

      <form name = f1> 
       <center> 
        <input type = button name = b00 value = "        " onclick = processInput(0,0) > 
        <input type = button name = b01 value = "        " onclick = processInput(0,1) > 
        <input type = button name = b02 value = "        " onclick = processInput(0,2) ><BR> 
        <input type = button name = b10 value = "        " onclick = processInput(1,0) > 
        <input type = button name = b11 value = "        " onclick = processInput(1,1) > 
        <input type = button name = b12 value = "        " onclick = processInput(1,2) ><BR> 
        <input type = button name = b20 value = "        " onclick = processInput(2,0) > 
        <input type = button name = b21 value = "        " onclick = processInput(2,1) > 
        <input type = button name = b22 value = "        " onclick = processInput(2,2) ><BR> 
      </center> 

    </form> 


  </BODY> 
</HTML> 

