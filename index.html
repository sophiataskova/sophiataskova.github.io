
<html>
<head>
  <title>Tic Tac Toe</title>
  <script type="text/javascript">
  var combinations = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  var board = [];

  function processInput (move) { 
    if (!board[move]) {
      display(move, -1);
      if (wins(0) < 0) {          
        alert("You win!");  
        clearBoard(); 
        return;       
      }
      next = alhpabeta(0, 1, -100, 100); // alpha = -∞, beta = ∞ ; player is 1 for user and -1 for computer
      if (next==undefined) {
        alert("This was a tie.");  
        clearBoard(); 
        return;
      }
      display(next); 
      if (wins(0) > 0) {
        alert("You lose.");  
        clearBoard(); 
        return;
      }
    }   
  }
  function wins(d){  // returns < 0 if computer wins and >0 if user wins
    for (c in combinations){
      x = o = 0;
      for (var j = 2; j >= 0; j--) {
        k = combinations[c][j];
        if (board[k] > 0) { // if cell is taken by x
          x++;
        }
        if (board[k] < 0) { // if cell is taken by o
          o++;
        }
      }
      if (x==3){ // user wins
        return 100 - d; 
      } 
      if (o==3) {
        return d - 100; // computer wins
      } 
    }
  }


function display(i, o)     {
  board[i] = o || 1;
  var row, col, p;
  if (i<3){
    row = 0;
  }
  else if (i>5) {
    row = 2;
  }
  else {
    row = 1;
  }
  col = i%3;
  if (o == -1) {
    p = "   X   ";
  }
  else {
    p = "   0   ";
  }
  if (row == 0 && col == 0)
    document.leform.b00.value = p
  else if (row == 0 && col == 1)
    document.leform.b01.value = p
  else if (row == 0 && col == 2)
    document.leform.b02.value = p
  else if (row == 1 && col == 0)
    document.leform.b10.value = p
  else if (row == 1 && col == 1)
    document.leform.b11.value = p
  else if (row == 1 && col == 2)
    document.leform.b12.value = p
  else if (row == 2 && col == 0)
    document.leform.b20.value = p
  else if (row == 2 && col == 1)
    document.leform.b21.value = p
  else if (row == 2 && col == 2) 
    document.leform.b22.value =p
}

function clearBoard() {
  for (i = 0; i< board.length; i++) {
    board[i] = undefined;
  }
  document.leform.b00.value = "        "
  document.leform.b01.value = "        "
  document.leform.b02.value = "        "
  document.leform.b10.value = "        "
  document.leform.b11.value = "        "
  document.leform.b12.value = "        "
  document.leform.b20.value = "        "
  document.leform.b21.value = "        "
  document.leform.b22.value = "        "
}

// "The Alpha-Beta Algorithm" https://www.cs.unm.edu/~aaron/downloads/qian_search.pdf
// d: search depth
function alhpabeta(d, player, alpha, beta){

  var next;
  var score;
  var min = -100;
  var val;

  if (wins(d)) {
    val = wins(d);    
    return player * val; // evaluate leaf position from current player’s standpoint
  }


  if (d < 10) {    // chose 10 for depth so as to keep moves relatively fast
    for(var i=0; i<9; i++){ 
      if (board[i]==undefined){  // look for available moves
        board[i] = player; // make move
        cur = -alhpabeta(d + 1, -player, -beta, -alpha);

        if (cur > score || score == undefined) {
          score = cur;
        }
        if (score > alpha) {
          alpha = score;
        }
        board[i] = undefined; // retract current move
        if (alpha >= beta) {
          return alpha; // cut off branch
        }
        if (score > min){ 
          min = score;
          next = i; 
        }
      }
    } 
  } 

  if (d > 0) {
    return score || 0; // 0 means a tie
  }

  else return next;
}
</script>
</head>

<body>
  <form name = leform> 
    <center> 
      <input type = button name = b00 value = "        " onclick = processInput(0) > 
      <input type = button name = b01 value = "        " onclick = processInput(1) > 
      <input type = button name = b02 value = "        " onclick = processInput(2) ><BR> 
      <input type = button name = b10 value = "        " onclick = processInput(3) > 
      <input type = button name = b11 value = "        " onclick = processInput(4) > 
      <input type = button name = b12 value = "        " onclick = processInput(5) ><BR> 
      <input type = button name = b20 value = "        " onclick = processInput(6) > 
      <input type = button name = b21 value = "        " onclick = processInput(7) > 
      <input type = button name = b22 value = "        " onclick = processInput(8) ><BR> 
    </center> 

  </form> 
</body>
</html>